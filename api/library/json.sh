#!/bin/sh

set -eu

F="${0%.sh}_sh.go"
trap "rm -f '$F~'" EXIT
exec > "$F~"

cat <<EOT
package library

//go:generate $0

import (
	"context"
	"os"

	"github.com/justprintit/mmf/api/library/json"
)

// Code generated by $0 DO NOT EDIT
EOT

for x in Shared:Users Purchases Pledges; do
	n="${x%:*}"
	if [ "$n" != "$x" ]; then
		t="${x#*:}"
	else
		t=Objects
	fi

	case "$n" in
	Pledges)
		g="campaings"
		;;
	*)
		g="$(echo "$n" | tr 'A-Z' 'a-z')"
		;;
	esac

cat <<EOT

func (c *Client) Get${n}Library(ctx context.Context) (*json.$t, error) {
	return c.Get${n}LibraryPage(ctx, 0)
}

func (c *Client) Get${n}LibraryPage(ctx context.Context, page int) (*json.$t, error) {
	out := &json.$t{}

	resp, err := c.GetLibraryPage(ctx, "$g", page, out)
	if err != nil {
		os.Stdout.Write(resp.Body())
	}
	return out, err
}
EOT
done

if ! diff -u "$F" "$F~" >&2; then
	mv "$F~" "$F"
fi
